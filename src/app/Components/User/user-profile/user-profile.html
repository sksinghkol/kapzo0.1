<div class="profile-page d-flex justify-content-center align-items-center vh-100">
  <div class="profile-card p-4">

    <!-- Profile Avatar -->
    <div class="profile-avatar text-center mb-3">
      <img [src]="safeProfilePic" alt="Profile" class="avatar-img">
      <button class="btn-edit-avatar" title="Edit Profile Picture">
        <i class="bi bi-pencil-fill"></i>
      </button>
    </div>

    <!-- View Mode -->
    <div *ngIf="!isEditing" class="text-center">
      <h2 class="user-name mb-2">{{ user.name }}</h2>
      <p class="text-muted mb-1"><i class="bi bi-envelope-fill me-2"></i>{{ user.email }}</p>
      <p class="mb-1"><i class="bi bi-telephone-fill me-2"></i>{{ user.phone || 'N/A' }}</p>
  <p class="mb-1">
    <i class="bi bi-geo-alt-fill me-2"></i>
    <span *ngIf="user.address.addressLine">{{ user.address.addressLine }}<br></span>
  {{ user.address.locality }}, {{ user.address.landmark ? (user.address.landmark + ',') : '' }} {{ user.address.city }},
  {{ user.address.state }}, {{ user.address.country }} - {{ user.address.pincode }}
  </p>
      <p class="text-muted mb-1"><strong>Member Since:</strong> {{ user.memberSince | date:'medium' }}</p>
  <p class="text-muted mb-3"><strong>Country:</strong> {{ user.address.country }}</p>
      <button class="btn btn-primary btn-lg" (click)="enableEdit()">
        <i class="bi bi-pencil-square me-2"></i>Edit Profile
      </button>
    </div>

    <!-- Edit Mode -->
    <form *ngIf="isEditing" (ngSubmit)="saveProfile()" class="mt-3">
      <div class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Name</label>
          <input type="text" [(ngModel)]="user.name" name="name" class="form-control form-control-lg">
        </div>
        <div class="col-md-6">
          <label class="form-label">Phone</label>
          <input type="text" [(ngModel)]="user.phone" name="phone" class="form-control form-control-lg">
        </div>
        <div class="col-md-6">
          <label class="form-label">Email</label>
          <input type="email" [(ngModel)]="user.email" name="email" class="form-control form-control-lg" readonly>
        </div>
        <div class="col-md-6">
          <label class="form-label">Member Since</label>
          <input type="text" [(ngModel)]="user.memberSince" name="memberSince" class="form-control form-control-lg" readonly>
        </div>
        <div class="col-12">
          <label class="form-label">Address</label>
          <textarea rows="3" [(ngModel)]="user.address.addressLine" name="addressLine" class="form-control"></textarea>
        </div>
        <div class="col-md-4">
          <label class="form-label">State</label>
          <select class="form-select form-control-lg" [(ngModel)]="user.address.state" name="state" (change)="onStateChange(user.address.state)" [disabled]="!statesLoaded">
            <option value="">{{ statesLoaded ? 'Select a state' : 'Loading states...' }}</option>
            <option *ngFor="let s of states" [value]="s">{{ s }}</option>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label">City</label>
          <select class="form-select form-control-lg" [(ngModel)]="user.address.city" name="city" [disabled]="!statesLoaded || !cities.length">
            <option value="">{{ statesLoaded ? 'Select a city' : 'Loading cities...' }}</option>
            <option *ngFor="let c of cities" [value]="c">{{ c }}</option>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label">Locality</label>
          <input type="text" [(ngModel)]="user.address.locality" name="locality" class="form-control form-control-lg">
        </div>
        <div class="col-md-4">
          <label class="form-label">Pincode</label>
          <input type="text" [(ngModel)]="user.address.pincode" name="pincode" class="form-control form-control-lg">
        </div>
        <div class="col-md-4">
          <label class="form-label">Country</label>
          <input type="text" [(ngModel)]="user.address.country" name="country" class="form-control form-control-lg">
        </div>
        <div class="col-md-4">
          <label class="form-label">Landmark</label>
          <input type="text" [(ngModel)]="user.address.landmark" name="landmark" class="form-control form-control-lg">
        </div>
      </div>

      <div class="d-flex justify-content-end mt-4 gap-2">
        <button type="submit" class="btn btn-success btn-lg">
          <i class="bi bi-check-circle me-2"></i>Save
        </button>
        <button type="button" class="btn btn-secondary btn-lg" (click)="isEditing=false">
          <i class="bi bi-x-circle me-2"></i>Cancel
        </button>
      </div>
    </form>

  </div>
</div>
